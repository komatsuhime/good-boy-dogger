<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Good Boy Dogger</title>
    <!-- by Carla Faroldi -->
    <script src="js/ga.js"></script>
    <script src="js/plugins.js"></script>
</head>

<body>
    <script>
    var dogger = ga(480, 480, setup);
    dogger.start();

    var dog, stuff, obstacle, barks, alerta, gameScene, GameOverScene;
    var dogMoved = false;

 //   	alerta = dogger.text(".", "20px Verdana", "black", 120, 120);
 //   	alerta.x = 120;
	// alerta.y = 120;

    function setup() {
        dogger.canvas.style.border = "1px black dashed";
        dogger.backgroundColor = "white";

        gameScene = dogger.group();
        dog = dogger.rectangle(24, 24, "pink");
        dog.x = dogger.canvas.width / 2 - dog.width;
        dog.y = dogger.canvas.height / 2 - dog.height;
        gameScene.addChild(dog);

        stuffs = [];
        for (var i = 0; i < 5; i++) {
            stuff = dogger.rectangle(24, 24, "orange");
            stuff.x = 24 * (dogger.randomInt(0, 19));
            stuff.y = 24 * (dogger.randomInt(0, 19));
            stuff.grabbed = false;
            stuffs.push(stuff);
            gameScene.addChild(stuff);
        }


        obstacles = [];

        dogger.fourKeyController(dog, 24, 38, 39, 40, 37);
        dogger.state = play;
    }

    function play() {
        dogger.move(dog);
        dogger.contain(dog, dogger.stage.localBounds);

        if ((dogger.key.leftArrow.isDown || dogger.key.upArrow.isDown || dogger.key.rightArrow.isDown || dogger.key.downArrow.isDown)) {
            obstacle = dogger.rectangle(24, 24, "grey");
            obstacle.x = 24 * (dogger.randomInt(0, 19));
            obstacle.y = 24 * (dogger.randomInt(0, 19));
            obstacles.push(obstacle);
            gameScene.addChild(obstacle);
            dogger.pause();
            dogger.wait(125, resume);
        }

        function resume() {
            dogger.resume();
        }

        var obstacleGrabbed = false;

        obstacles.forEach(function(obstacle) {
            if (dogger.hitTestRectangle(dog, obstacle)) {
                obstacleGrabbed = true;
            } else {
            	// obstacleGrabbed = false;
            }
        });

        if (obstacleGrabbed == true) {
        	if (dog.vx < 0) {
        		dog.x += 24;
        	}
        	if (dog.vx > 0) {
        		dog.x -= 24;
        	}
        	if (dog.vy < 0) {
        		dog.y += 24;
        	}
        	if (dog.vy > 0) {
        		dog.y -= 24;
        	}
        }
    }

    </script>
    </body>

</html>