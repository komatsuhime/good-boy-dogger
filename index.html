<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Good Boy Dogger</title>
    <!-- by Carla Faroldi -->
    <script src="js/ga.js"></script>
    <script src="js/plugins.js"></script>
</head>

<body>
    <script>
    var doggerWidth	 = 480;
    var doggerHeight = 480;
    var dogger = ga(doggerWidth, doggerHeight, setup);
    dogger.start();

    var dog, stuff, obstacle, barksLeft, bark, alerta, gameScene, GameOverScene;
    var win = 0;
    var stuffAmount;
    

    alerta = dogger.text(" ", "20px Verdana", "fuchsia", 120, 120);
    alerta.x = 120;
    alerta.y = 120;
    
    var size;

function setup() {
        dogger.canvas.style.border = "1px black dashed";
        dogger.backgroundColor = "white";
        
        size = 24;
        stuffAmount = 10;
        
        gameScene = dogger.group();
        dog = dogger.rectangle(size, size, "pink");
        dog.x = dogger.canvas.width / 2 - dog.width;
        dog.y = dogger.canvas.height / 2 - dog.height;
        gameScene.addChild(dog);

        bark = dogger.keyboard(98);
           bark.press = function() {
                 console.log(bark);
            };

        stuffs = [];
        for (var i = 0; i < stuffAmount; i++) {
            stuff = dogger.rectangle(size, size, "orange");
            stuff.x = size * (dogger.randomInt(0, 19));
            stuff.y = size * (dogger.randomInt(0, 19));
            stuffs.push(stuff);
            gameScene.addChild(stuff);
        }
        
        obstacles = [];

        dogger.fourKeyController(dog, size, 38, 39, 40, 37);
        dogger.state = play;
}

function play() {
        dogger.move(dog);
        dogger.contain(dog, dogger.stage.localBounds);

        if (dogger.key.leftArrow.isDown || dogger.key.upArrow.isDown || dogger.key.rightArrow.isDown || dogger.key.downArrow.isDown) {
            obstacle = dogger.rectangle(size, size, "grey");

            var occupiedX = stuffs.map(function(s) { return s.x; });
            var occupiedY = stuffs.map(function(s) { return s.y; });
            var positionX = size * (dogger.randomInt(0, 19));
            var positionY = size * (dogger.randomInt(0, 19));
            obstacle.x = occupied(occupiedX, positionX);
            obstacle.y = occupied(occupiedY, positionY);

            obstacles.push(obstacle);
            gameScene.addChild(obstacle);
            dogger.pause();
            dogger.wait(125, resume);
        }

        function resume() {
            dogger.resume();
        }

        function occupied(a, v, size) {
            if (a.indexOf(v) == -1) {
                return v;
            } else {
                v = size * (dogger.randomInt(0, 19));
                occupied(a, v, size);
            }
        }

        stuffs = stuffs.filter(function(stuff) {
            if (dogger.hit(dog, stuff)) {
                win += 1;
                gameScene.remove(stuff);
                return false;
            } else {
                return true;
            }
        });

        if (win == stuffAmount) {
           alerta.content = "You won!";
        }

        //FIX!!
        if (dogger.key.space.isDown) {
            obstacles = obstacles.filter(function(obstacle){
                gameScene.remove(obstacle);
                return false;
            });
        }

        var obstacleHit = false;

        obstacles.forEach(function(obstacle) {
            if (dogger.hitTestRectangle(dog, obstacle)) {
                obstacleHit = true;
            } else {
                // obstacleHit = false;
            }
        });

        if (obstacleHit == true) {
            //moves to the left
            if (dog.vx < 0) {
                dog.x += size;
            }
            //moves to the right
            if (dog.vx > 0) {
                dog.x -= size;
            }
            //moves up
            if (dog.vy < 0) {
                dog.y += size;
            }
            //moves down
            if (dog.vy > 0) {
                dog.y -= size;
            }
        }
    }
    </script>
    <p>Move and pick up the orange squares to win. You're a dog, by the way.</p>
    <ul>
        <li>Arrow keys: move</li>
        <li>Spacebar: bark (remove all obstacles)</li>
    </ul>
</body>

</html>
